/* http://keith-wood.name/icalendar.html
   iCalendar processing for jQuery v1.1.1.
   Written by Keith Wood (kbwood{at}iinet.com.au) October 2008.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */function TkMap(e){var t=typeof e.lat!="undefined"?e.lat:null,n=typeof e.lng!="undefined"?e.lng:null,r=typeof e.domid!="undefined"?e.domid:null,s=typeof e.zoom!="undefined"?e.zoom:15,o=typeof e.init!="undefined"?e.init:!1,u=typeof e.responsive!="undefined"?e.responsive:!1,a=typeof e.styles!="undefined"?e.styles:null,f={center:new google.maps.LatLng(t,n),draggable:!0,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,streetViewControl:!1,styles:[],zoom:s,zoomControl:!0},l=!1,c=null,h=null;this.Map=null;var p=function(e){l=!0;c=e.touches[0].pageY},d=function(){l=!1},v=function(e){if(!l)return;h=e.touches[0].pageY;window.scrollBy(0,c-h)},m=function(){var e=a.split(" ");for(i in e)if(e[i]==="satellite")f.mapTypeId=google.maps.MapTypeId.SATELLITE;else if(e[i]==="hybrid")f.mapTypeId=google.maps.MapTypeId.HYBRID;else if(e[i]==="road")f.mapTypeId=google.maps.MapTypeId.ROADMAP;else if(e[i]==="terrain")f.mapTypeId=google.maps.MapTypeId.TERRAIN;else if(e[i]==="minlabels")f.styles.push({featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]});else if(e[i]==="grey"){f.backgroundColor="#C5C5C5";f.styles.push({stylers:[{saturation:-99}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:85}]},{featureType:"water",stylers:[{lightness:-40}]})}},g=function(){var e=$("#"+r).width();e<481?f.zoom--:e>959&&f.zoom++};this.initMap=function(){if(this.Map===null){a!==null&&m();u&&g();this.Map=new google.maps.Map(document.getElementById(r),f)}};this.setMapOptions=function(e){this.Map!==null&&$.extend(f,e)};this.setTouchScroll=function(e){var t=document.getElementById(r);if(e){t.addEventListener("touchstart",p,!0);t.addEventListener("touchend",d,!0);t.addEventListener("touchmove",v,!0);this.Map.setOptions({zoomControl:!1})}else{t.removeEventListener("touchstart",p,!0);t.removeEventListener("touchend",d,!0);t.removeEventListener("touchmove",v,!0);this.Map.setOptions({zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}})}};this.setPanZoom=function(e){var t;e?t=!1:t=!0;this.Map.setOptions({disableDoubleClickZoom:t,draggable:e,keyboardShortcuts:e,scrollwheel:e,zoomControl:e})};o===!0&&this.initMap()}function TkMapFusionLayer(e){var t=typeof e.map!="undefined"?e.map:null,n=typeof e.geo!="undefined"?e.geo:null,r=typeof e.tableid!="undefined"?e.tableid:null,i=typeof e.where!="undefined"?e.where:null,s=typeof e.icon!="undefined"?e.icon:null,o=typeof e.style!="undefined"?e.style:null;this.Layer=null;this.showLayer=function(e){var u=typeof e.where!="undefined"?e.where:i,a=typeof e.icon!="undefined"?e.icon:s,f=typeof e.linestyle!="undefined"?e.style:o;this.hideLayer();var l=null;u===null?l={select:n,from:r}:l={select:n,from:r,where:u};a!==null?this.Layer=new google.maps.FusionTablesLayer({clickable:!0,query:l,styles:[{markerOptions:{iconName:a}}]}):f!==null?this.Layer=new google.maps.FusionTablesLayer({clickable:!0,query:l,styles:f}):this.Layer=new google.maps.FusionTablesLayer({clickable:!0,query:l});this.Layer.setMap(t)};this.hideLayer=function(){this.Layer!==null&&this.Layer.setMap(null)};t!==null&&n!==null&&r!==null&&this.showLayer({})}function loadScript(){var e=document.createElement("script");e.type="text/javascript";e.src="http://maps.googleapis.com/maps/api/js?key="+config.api_key+"&sensor=true&callback=initialize";document.body.appendChild(e)}function initialize(){function S(e,t,n,r){if($("#ical").hasClass("hasICalendar")){$("#ical").icalendar("change",{start:e,end:t,description:n,location:r});$(".icalendar_compact").css("border","0px");$("#ical-file").icalendar("change",{start:e,end:t,description:n,location:r})}else{$("#ical").icalendar({start:e,end:t,title:config.cal_title,summary:config.cal_summary,description:n,location:r,iconSize:0,sites:["google","yahoo"]});$(".icalendar_compact").css("border","0px");$("#ical-file").icalendar({start:e,end:t,title:config.cal_title,summary:config.cal_summary,description:n,location:r,iconSize:0,sites:["icalendar","outlook"],echoUrl:"ical.php"})}}function x(){google.maps.event.addListener(m.Layer,"click",function(e){s=e.row;var t=s.Date.value.split("/");s.Hours.value.replace(/\s/g,"");var i=s.Hours.value.split("-"),o=i[0].split(":"),u=i[1].split(":"),a=o[1].match(/PM/i);a!==null&&o[0]!=12&&(o[0]=parseInt(o[0],10)+12);var f=u[1].match(/PM/i);f!==null&&u!=12&&(u[0]=parseInt(u[0],10)+12);var l=o[1].match(/^[0-9]{2}/),c=u[1].split(/^[0-9]{2}/),h=new Date(t[2],t[0]-1,t[1],o[0],l[0],0),p=new Date(t[2],t[0]-1,t[1],u[0],c[0],0);$("#grp-ical").show(500);S(h,p,s.Name.value,s.Location.value);r=!0;$("#eventselected").html("<b>"+s.Name.value+"</b>");n!==null&&$("#grp-cta").show(750);$("#grp-reset").show(750)})}function T(e,t){e.style.padding="1em";var n=document.createElement("div");n.style.backgroundColor="white";n.style.borderStyle="solid";n.style.borderWidth="2px";n.style.cursor="pointer";n.style.textAlign="center";n.title="Click to set the map to Home";e.appendChild(n);var r=document.createElement("div");r.style.fontFamily="sans-serif";r.style.fontSize="12px";r.style.paddingLeft=".5em";r.style.paddingRight=".5em";r.style.paddingTop=".3em";r.style.paddingBottom=".3em";r.innerHTML="Maximize";n.appendChild(r);google.maps.event.addDomListener(n,"click",function(){if(o.Map.zoomControl==0){o.setPanZoom(!0);o.setTouchScroll(!1);var e=o.Map.getCenter();$("#span-info,#footer").hide(750,function(){$("#span-map").addClass("span12");$("#span-map").removeClass("span7");$("#map-width").css("height","100%");$("#map-ratio").css("margin-top",window.innerHeight);$("#span-map").offset().top;r.innerHTML="Minimize";o.Map.setCenter(e);google.maps.event.trigger(o.Map,"resize")})}else{o.setPanZoom(!1);o.setTouchScroll(!0);var e=o.Map.getCenter();$("#span-info,#footer").show(750,function(){$("#span-map").addClass("span7");$("#span-map").removeClass("span12");$("#map-width").css("height","");window.innerWidth<768?$("#map-ratio").css("margin-top","80%"):$("#map-ratio").css("margin-top","100%");r.innerHTML="Maximize";o.Map.setCenter(e);google.maps.event.trigger(o.Map,"resize")})}})}function N(){n!==null&&n.setMap(null);i!==null&&i.setMap(null);$("#grp-day").hide(750);$(".day").removeClass("marked active");var e=new google.maps.Geocoder;e.geocode({address:$("#location").val()+", "+config.city+", "+config.state},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[0]){o.Map.panTo(e[0].geometry.location);O(e[0].geometry.location)}else C();else C()})}function C(){alert("We're sorry. We could not locate this address. Please doublecheck you've entered your address correctly.")}function k(){var e=v;if($("#btn-day-su").hasClass("marked")||$("#btn-day-mo").hasClass("marked")||$("#btn-day-tu").hasClass("marked")||$("#btn-day-we").hasClass("marked")||$("#btn-day-th").hasClass("marked")||$("#btn-day-fr").hasClass("marked")||$("#btn-day-sa").hasClass("marked")){e+=" AND Day IN (";$("#btn-day-su").hasClass("marked")&&(e+="'Sunday',");$("#btn-day-mo").hasClass("marked")&&(e+="'Monday',");$("#btn-day-tu").hasClass("marked")&&(e+="'Tuesday',");$("#btn-day-we").hasClass("marked")&&(e+="'Wednesday',");$("#btn-day-th").hasClass("marked")&&(e+="'Thursday',");$("#btn-day-fr").hasClass("marked")&&(e+="'Friday',");$("#btn-day-sa").hasClass("marked")&&(e+="'Saturday',");e=e.substring(0,e.length-1);e+=")"}m.showLayer({where:e});x()}function L(){var e="Date >= '"+l+"."+(f<=9?"0"+f:f)+"."+(a<=9?"0"+a:a)+"'";e=e+" AND Date <= '"+d+"."+(p<=9?"0"+p:p)+"."+(h<=9?"0"+h:h)+"'";m.showLayer({where:e});x()}function A(e){e?alert("We're sorry. Your browser's geolocation service failed."):alert("We're sorry! Your browser does not support geolocation.")}function O(e){n!==null&&n.setMap(null);if(i!==null){i.setMap(null);i=null}n=new google.maps.Marker({position:e,map:o.Map});i=new google.maps.Circle({center:e,clickable:!1,fillOpacity:.075,map:o.Map,radius:5e3,strokeWeight:1});o.Map.panToBounds(i.getBounds());o.Map.fitBounds(i.getBounds());m.showLayer({where:v});x();$("#grp-find").show(750);$("#grp-reset").show();r===!0&&$("#grp-cta").show(750)}function M(e){var t=new google.maps.Geocoder;t.geocode({latLng:e},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[1]){var n=e[0].formatted_address.split(",");$("#location").val(n[0]);$("#location").blur();s!==null&&$("#grp-cta").show(750)}else alert("We're sorry. We could not find an address for this location.");else alert("We're sorry. We could not find an address for this location.")})}var e=Modernizr.touch,t=navigator.geolocation,n=null,r=!1,i=null,s=null;window.frames.length!=parent.frames.length&&$("#footer").hide();var o=new TkMap({domid:"map",init:!0,lat:config.default_lat,lng:config.default_lng,styles:config.map_style,zoom:config.initial_zoom}),u=new Date,a=u.getDate(),f=u.getMonth()+1,l=u.getFullYear(),c=new Date(u);c.setDate(c.getDate()+7);var h=c.getDate(),p=c.getMonth()+1,d=c.getFullYear(),v="Date >= '"+l+"."+(f<=9?"0"+f:f)+"."+(a<=9?"0"+a:a)+"'",m=new TkMapFusionLayer({geo:"Location",map:o.Map,tableid:config.table_id,where:v}),g={suppressInfoWindows:!0,polylineOptions:{strokeColor:config.stroke_color,strokeWeight:config.stroke_weight,strokeOpacity:config.stroke_opacity}},y=new google.maps.DirectionsService,b=new google.maps.DirectionsRenderer(g);t&&$("#btn-gps-location").removeClass("hide");if(e){o.setPanZoom(!1);o.setTouchScroll(!0);var w=document.createElement("div"),E=new T(w,o.Map);w.index=1;o.Map.controls[google.maps.ControlPosition.TOP_RIGHT].push(w)}x();$("#location").keyup(function(e){$(this).val().length>0&&e.which==13&&N()});$(".cta").click(function(){var e=$(this).attr("id"),t={};if(e=="ctarouteevent"){s.Hours.value.replace(/\s/g,"");var n=s.Hours.value.split("-");if($.trim(n[0])=="12:00PM"||$.trim(n[0])=="12:00 PM")n[0]="12:00";var r=s.Date.value+" "+n[0],i=Date.parse(r).getTime();t={arrivalTime:new Date(i)}}b.setMap(o.Map);$("#directions").html("");b.setPanel(document.getElementById("directions"));var u={origin:$("#location").val()+", "+config.city+", "+config.state,destination:s.Location.value,transitOptions:t,travelMode:google.maps.TravelMode.TRANSIT};y.route(u,function(t,n){if(n==google.maps.DirectionsStatus.OK){$("#theform").hide(750);$("#span-cta").show(750);var r=0;for(var i=0;i<t.routes.length;i++){for(var o=0;o<t.routes[i].legs[0].steps.length;o++)if(t.routes[i].legs[0].steps[o].travel_mode=="TRANSIT"){r=i;break}delete t.routes[i].warnings;t.routes[i].copyrights=""}$("#directions").html();$("#timetoleave").html();b.setDirections(t);e=="ctarouteevent"?$("#timetoleave").html("<b>Directions</b><br>Leave by "+t.routes[r].legs[0].departure_time.text+" on "+s.Date.value+"</p>"):$("#timetoleave").html("<b>Directions</b><br>Leave by "+t.routes[r].legs[0].departure_time.text+"</p>")}else{typeof b!="undefined"&&b.setMap(null);$("#theform").hide(750);$("#span-cta").show(750);$("#timetoleave").html('<p class="lead">Directions</p>');$("#directions").html("<p><b>We are sorry. We cannot route you to this clinic.</b> It is likely that your local transit authority has not released schedule times for the date of your travel yet. Please check back soon.</p>")}});x()});$("#btn-by-day").click(function(){$("#grp-day").show(750)});$(".search").click(function(){$(this).hasClass("marked")?$(this).removeClass("marked"):$(this).addClass("marked");k()});$("#week").click(function(){$(".day,#btn-date-all").removeClass("active");$("#grp-day").hide(750);$("#btn-date-available").addClass("active");L()});$("#reset-map").click(function(){$(".day").removeClass("active marked");$("#grp-day,#grp-find,#grp-cta,#span-cta,#grp-ical,#grp-reset").hide(750);$("#ical,#ical-file,#eventselected,#timetoleave,#directions").html("");$("#location").val("");$("#theform").show(750);s=null;k();if(n!==null){n.setMap(null);n=null}if(i!==null){i.setMap(null);i=null}typeof b!="undefined"&&b.setMap(null);r=!1;o.Map.setZoom(11);var e=new google.maps.LatLng(defaultLat,defaultLng);o.Map.panTo(e)});$("#btn-gps-location").click(function(){t?navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);o.Map.panTo(t);M(t);O(t)},function(){A(!0)}):A(!1)});$("#btn-search-location").click(function(){$("#location").val().length>0&&N()})}(function(e){function r(){this._defaults={sites:[],icons:"icalendar.png",iconSize:16,target:"_blank",compact:!1,popup:!1,popupText:"Send to my calendar...",tipPrefix:"",echoUrl:"",echoField:"",start:null,end:null,title:"",summary:"",description:"",location:"",url:"",contact:"",recurrence:null,copyConfirm:"The event will be copied to your clipboard. Continue?",copySucceeded:"The event has been copied to your clipboard",copyFailed:"Failed to copy the event to the clipboard\n",copyFlash:"clipboard.swf",copyUnavailable:"The clipboard is unavailable, please copy the event details from below:\n"};this._sites={google:{display:"Google",icon:0,override:null,url:"http://www.google.com/calendar/event?action=TEMPLATE&amp;text={t}&amp;dates={s}/{e}&amp;details={d}&amp;location={l}&amp;sprop=website:{u}"},icalendar:{display:"iCalendar",icon:1,override:null,url:"echo"},outlook:{display:"Outlook",icon:2,override:null,url:"echo"},yahoo:{display:"Yahoo",icon:3,override:p,url:"http://calendar.yahoo.com/?v=60&amp;view=d&amp;type=20&amp;title={t}&amp;st={s}&amp;dur={p}&amp;desc={d}&amp;in_loc={l}&amp;url={u}&amp;rpat={r}"}}}function h(t,n){e.extend(t,n);for(var r in n)n[r]==null&&(t[r]=null);return t}function p(e,t){var n=function(e){return(e<10?"0":"")+e},r=t.end?(t.end.getTime()-t.start.getTime())/6e4:0;e.p=r?n(Math.floor(r/60))+""+n(r%60):"";if(e.r){var i=t.recurrence.by&&t.recurrence.by[0].type=="day"?t.recurrence.by[0].values.join("").toLowerCase():"",s={daily:"dy",weekly:"wk",monthly:"mh",yearly:"yr"}[t.recurrence.freq];e.r=i||s?n(t.recurrence.interval||1)+(i||s):""}}function d(t){var n=function(e){var t="";while(e.length>75){t+=e.substr(0,75)+"\n";e=" "+e.substr(75)}t+=e;return t};return"BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:jquery.icalendar\nMETHOD:PUBLISH\nBEGIN:VEVENT\nUID:"+(new Date).getTime()+"@"+(window.location.href.replace(/^[^\/]*\/\/([^\/]*)\/.*$/,"$1")||"localhost")+"\n"+"DTSTAMP:"+e.icalendar.formatDateTime(new Date)+"\n"+(t.url?n("URL:"+t.url)+"\n":"")+(t.contact?n("MAILTO:"+t.contact)+"\n":"")+n("TITLE:"+t.title)+"\n"+"DTSTART:"+e.icalendar.formatDateTime(t.start)+"\n"+"DTEND:"+e.icalendar.formatDateTime(t.end)+"\n"+(t.summary?n("SUMMARY:"+t.summary)+"\n":"")+(t.description?n("DESCRIPTION:"+t.description)+"\n":"")+(t.location?n("LOCATION:"+t.location)+"\n":"")+(t.recurrence?v(t.recurrence)+"\n":"")+"END:VEVENT\n"+"END:VCALENDAR"}function v(t){if(!t)return"";var n="";if(t.dates){n="RDATE;VALUE=DATE:";j(t.dates)||(t.dates=[t.dates]);for(var r=0;r<t.dates.length;r++)n+=(r>0?",":"")+e.icalendar.formatDate(t.dates[r])}else if(t.times){n="RDATE;VALUE=DATE-TIME:";j(t.times)||(t.times=[t.times]);for(var r=0;r<t.times.length;r++)n+=(r>0?",":"")+e.icalendar.formatDateTime(t.times[r])}else if(t.periods){n="RDATE;VALUE=PERIOD:";j(t.periods[0])||(t.periods=[t.periods]);for(var r=0;r<t.periods.length;r++)n+=(r>0?",":"")+e.icalendar.formatDateTime(t.periods[r][0])+"/"+(t.periods[r][1].constructor!=Date?t.periods[r][1]:e.icalendar.formatDateTime(t.periods[r][1]))}else{n="RRULE:FREQ="+(t.freq||"daily").toUpperCase()+(t.interval?";INTERVAL="+t.interval:"")+(t.until?";UNTIL="+e.icalendar.formatDateTime(t.until):t.count?";COUNT="+t.count:"")+(t.weekStart!=null?";WKST="+["SU","MO","TU","WE","TH","FR","SA"][t.weekStart]:"");if(t.by){j(t.by)||(t.by=[t.by]);for(var r=0;r<t.by.length;r++){j(t.by[r].values)||(t.by[r].values=[t.by[r].values]);n+=";BY"+t.by[r].type.toUpperCase()+"="+t.by[r].values.join(",")}}}return n}function m(t,r){e("#"+n).remove();try{e("body").append('<div id="'+n+'"><embed src="'+r+'" FlashVars="clipboard='+encodeURIComponent(t)+'" width="0" height="0" type="application/x-shockwave-flash"></embed></div>');return""}catch(i){return i}}function k(t){var n=t.replace(/\r\n/g,"\n").split("\n");for(var r=n.length-1;r>0;r--){var i=g.exec(n[r]);if(i){n[r-1]+=i[1];n[r]=""}}return e.map(n,function(e,t){return e?e:null})}function L(e,t,n,r){if(t>=e.length||e[t].indexOf("BEGIN:")!=0)throw"Missing group start";var i={},s=e[t].substr(6);O(n,s.toLowerCase(),i);t++;while(t<e.length&&e[t].indexOf("END:")!=0){if(e[t].indexOf("BEGIN:")==0)t=L(e,t,i,r);else{var o=M(e[t]);O(i,o._name,o._simple?o._value:o)}t++}if(s=="VTIMEZONE"){var u=T.exec(i.standard.tzoffsetto);u&&(r[i.tzid]=(u[1]=="-"?-1:1)*(parseInt(u[2],10)*60+parseInt(u[3],10)))}else for(var a in i)A(i[a],r);if(e[t]!="END:"+s)throw"Missing group end "+s;return t}function A(e,t){if(!e)return;if(e.tzid&&e._value){var n=t[e.tzid],r=function(e,t){e.setMinutes(e.getMinutes()-n);e._type=t};if(j(e._value))for(var i=0;i<e._value.length;i++)r(e._value[i],e.tzid);else if(e._value.start&&e._value.end){r(e._value.start,e.tzid);r(e._value.end,e.tzid)}else r(e._value,e.tzid)}else if(j(e))for(var i=0;i<e.length;i++)A(e[i],t)}function O(t,n,r){typeof r=="string"&&(r=r.replace(/\\n/g,"\n"));e.inArray(n,C)>-1&&(n+="_");if(t[n]){if(!j(t[n])||t["_"+n+"IsArray"])t[n]=[t[n]];t[n][t[n].length]=r;t["_"+n+"IsArray"]&&(t["_"+n+"IsArray"]=undefined)}else{t[n]=r;j(r)&&(t["_"+n+"IsArray"]=!0)}}function M(e){var t={},n=y.exec(e);if(!n)throw"Missing entry name: "+e;t._name=n[1].toLowerCase();t._value=D(n[3]);t._simple=!0;_(t,n[2]);return t}function _(e,t){var n=b.exec(t);while(n){var r=[],i=w.exec(n[2]);while(i){r.push(D(i[1].replace(/^"(.*)"$/,"$1")));i=w.exec(n[2])}e[n[1].toLowerCase()]=r.length>1?r:r[0];e._simple=!1;n=b.exec(t)}}function D(e){var t=S.exec(e);if(t)return P(t);t=x.exec(e);if(t)return{start:P(t),end:P(t.slice(7))};t=E.exec(e);return t?P(t.concat([0,0,0,""])):e}function P(e){var t=new Date(e[1],e[2]-1,e[3],e[4],e[5],e[6]);t._type=e[7]?"UTC":"float";return H(t)}function H(e){e.setMinutes(e.getMinutes()-e.getTimezoneOffset());return e}function B(e,t){t=t||t==0?t:1;var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getTimezoneOffset()/-60),r=new Date(n.getFullYear(),0,4),s=r.getDay();r.setDate(4+t-s-(t>s?7:0));if(n<r){n.setDate(n.getDate()-3);return B(n,t)}if(n>new Date(n.getFullYear(),11,28)){var o=new Date(n.getFullYear()+1,0,4);s=o.getDay();o.setDate(4+t-s-(t>s?7:0));if(n>=o)return 1}return Math.floor((n-r)/(i[a].factor*1e3)/7)+1}function j(e){return e&&e.constructor==Array}var t="icalendar",n="icalendar-flash-copy",i=[{method:"Seconds",factor:1},{method:"Minutes",factor:60},{method:"Hours",factor:3600},{method:"Date",factor:86400},{method:"Month",factor:1},{method:"FullYear",factor:12},{method:"Date",factor:604800}],s=0,o=1,u=2,a=3,f=4,l=5,c=6;e.extend(r.prototype,{markerClassName:"hasICalendar",setDefaults:function(e){h(this._defaults,e||{});return this},addSite:function(e,t,n,r,i){this._sites[e]={display:t,icon:n,override:i,url:r};return this},getSites:function(){return this._sites},_attachICalendar:function(t,n){t=e(t);if(t.hasClass(this.markerClassName))return;t.addClass(this.markerClassName);this._updateICalendar(t,n)},_changeICalendar:function(t,n){t=e(t);if(!t.hasClass(this.markerClassName))return;this._updateICalendar(t,n)},_updateICalendar:function(n,r){r=h(e.extend({},this._defaults,e.data(n[0],t)||{}),r);e.data(n[0],t,r);var i=r.sites||this._defaults.sites;i.length==0&&e.each(this._sites,function(e){i[i.length]=e});var s=function(t,i){var s={t:encodeURIComponent(r.title),d:encodeURIComponent(r.description),s:e.icalendar.formatDateTime(r.start),e:e.icalendar.formatDateTime(r.end),p:e.icalendar.calculateDuration(r.start,r.end),l:encodeURIComponent(r.location),u:encodeURIComponent(r.url),c:encodeURIComponent(r.contact),r:v(r.recurrence)};t.override&&t.override.apply(n,[s,r]);var o=t.url;e.each(s,function(e,t){var n=new RegExp("\\{"+e+"\\}","g");o=o.replace(n,t)});var o=t.url=="echo"?"#":o,u=e("<li></li>"),a=e('<a href="'+o+'" title="'+r.tipPrefix+t.display+'"'+(t.url=="echo"?"":' target="'+r._target+'"')+"></a>");t.url=="echo"&&a.click(function(){return e.icalendar._echo(n[0],i)});var f="";if(t.icon!=null){typeof t.icon=="number"?f+='<span style="background: transparent url('+r.icons+") no-repeat -"+t.icon*r.iconSize+"px 0px;"+(e.browser.mozilla&&e.browser.version<"1.9"?" padding-left: "+r.iconSize+"px; padding-bottom: "+Math.max(0,r.iconSize/2-5)+"px;":"")+'"></span>':f+='<img src="'+t.icon+'"'+(e.browser.mozilla&&e.browser.version<"1.9"||e.browser.msie&&e.browser.version<"7.0"?' style="vertical-align: bottom;"':e.browser.msie?' style="vertical-align: middle;"':e.browser.opera||e.browser.safari?' style="vertical-align: baseline;"':"")+"/>";f+=r.compact?"":"&#xa0;"}a.html(f+(r.compact?"":t.display));u.append(a);return u},o=e('<ul class="icalendar_list'+(r.compact?" icalendar_compact":"")+'"></ul>'),u=this._sites;e.each(i,function(e,t){o.append(s(u[t],t))});n.empty().append(o);if(r.popup){o.before('<span class="icalendar_popup_text">'+r.popupText+"</span>").wrap('<div class="icalendar_popup"></div>');n.click(function(){var t=e(this),n=t.offset();e(".icalendar_popup",t).css("left",n.left).css("top",n.top+t.outerHeight()).toggle()})}},_destroyICalendar:function(n){n=e(n);if(!n.hasClass(this.markerClassName))return;n.removeClass(this.markerClassName).empty();e.removeData(n[0],t)},_echo:function(n,r){var i=e.data(n,t),s=d(i);if(i.echoUrl)window.location.href=i.echoUrl+"?content="+escape(s);else if(i.echoField)e(i.echoField).val(s);else if(!i.copyFlash)alert(i.copyUnavailable+s);else if(confirm(i.copyConfirm)){var o="";(o=m(s,i.copyFlash))?alert(i.copyFailed+o):alert(i.copySucceeded)}return!1},_ensureTwo:function(e){return(e<10?"0":"")+e},formatDate:function(e,t){return e?""+e.getFullYear()+this._ensureTwo(e.getMonth()+1)+this._ensureTwo(e.getDate()):""},formatDateTime:function(e,t){return e?t?""+e.getFullYear()+this._ensureTwo(e.getMonth()+1)+this._ensureTwo(e.getDate())+"T"+this._ensureTwo(e.getHours())+this._ensureTwo(e.getMinutes())+this._ensureTwo(e.getSeconds()):""+e.getUTCFullYear()+this._ensureTwo(e.getUTCMonth()+1)+this._ensureTwo(e.getUTCDate())+"T"+this._ensureTwo(e.getUTCHours())+this._ensureTwo(e.getUTCMinutes())+this._ensureTwo(e.getUTCSeconds())+"Z":""},calculateDuration:function(e,t){if(!e||!t)return"";var n=Math.abs(t.getTime()-e.getTime())/1e3,r=Math.floor(n/86400);n-=r*86400;var i=Math.floor(n/3600);n-=i*3600;var s=Math.floor(n/60);n-=s*60;return(e.getTime()>t.getTime()?"-":"")+"P"+(r>0?r+"D":"")+(i||s||n?"T"+i+"H":"")+(s||n?s+"M":"")+(n?n+"S":"")},addDuration:function(e,t){if(!t)return e;var n=new Date(e.getTime()),r=N.exec(t);if(!r)throw"Invalid duration";if(r[2]&&(r[3]||r[5]||r[6]||r[7]))throw"Invalid duration - week must be on its own";if(!r[4]&&(r[5]||r[6]||r[7]))throw"Invalid duration - missing time marker";var i=r[1]=="-"?-1:1,s=function(e,t,r){e=parseInt(e);isNaN(e)||n["setUTC"+r](n["getUTC"+r]()+i*e*t)};if(r[2])s(r[2],7,"Date");else{s(r[3],1,"Date");s(r[5],1,"Hours");s(r[6],1,"Minutes");s(r[7],1,"Seconds")}return n},parse:function(e){var t={},n={},r=k(e);L(r,0,t,n);if(!t.vcalendar)throw"Invalid iCalendar data";return t.vcalendar},getWeekOfYear:function(e,t){return B(e,t)},_parseParams:function(e,t){return _(e,t)}});e.fn.icalendar=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){typeof t=="string"?e.icalendar["_"+t+"ICalendar"].apply(e.icalendar,[this].concat(n)):e.icalendar._attachICalendar(this,t||{})})};e.icalendar=new r;var g=/^\s(.*)$/,y=/^([A-Za-z0-9-]+)((?:;[A-Za-z0-9-]+=(?:"[^"]+"|[^";:,]+)(?:,(?:"[^"]+"|[^";:,]+))*)*):(.*)$/,b=/;([A-Za-z0-9-]+)=((?:"[^"]+"|[^";:,]+)(?:,(?:"[^"]+"|[^";:,]+))*)/g,w=/,?("[^"]+"|[^";:,]+)/g,E=/^(\d{4})(\d\d)(\d\d)$/,S=/^(\d{4})(\d\d)(\d\d)T(\d\d)(\d\d)(\d\d)(Z?)$/,x=/^(\d{4})(\d\d)(\d\d)T(\d\d)(\d\d)(\d\d)(Z?)\/(\d{4})(\d\d)(\d\d)T(\d\d)(\d\d)(\d\d)(Z?)$/,T=/^([+-])(\d\d)(\d\d)$/,N=/^([+-])?P(\d+W)?(\d+D)?(T)?(\d+H)?(\d+M)?(\d+S)?$/,C=["class"]})(jQuery);var config={api_key:"AIzaSyCgLuPh5k9eKka2uHJXxov4OCCRaMTQUa8",table_id:"5313521",default_lat:"41.85",default_lng:"-87.675",city:"Chicago",state:"IL",initial_zoom:11,map_style:"grey",stroke_color:"#0954cf",stroke_weight:"5",stroke_opacity:".85",cal_title:"CDPH Free Flu Shot Event",cal_summary:"CDPH Free Flu Shot Event",transit_name:"CTA"};window.onload=loadScript;